<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
Module    : Database.Orville.Internal.Types
Copyright : Flipstone Technology Partners 2016-2018
License   : MIT
-}</span><span>
</span><a name="line-6"></a><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE DeriveDataTypeable #-}</span><span>
</span><a name="line-8"></a><span class="hs-pragma">{-# LANGUAGE ExistentialQuantification #-}</span><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><a name="line-10"></a><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><a name="line-11"></a><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><a name="line-12"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Database.Orville.Internal.Types</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-13"></a><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span>            </span><span class="hs-identifier">Control.Exception</span><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span>            </span><span class="hs-identifier">Control.Monad.Except</span><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span>            </span><span class="hs-identifier">Control.Monad.Reader</span><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span>            </span><span class="hs-identifier">Control.Monad.State</span><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span>            </span><span class="hs-identifier">Control.Monad.Writer</span><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span>  </span><span class="hs-identifier">Data.List</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">List</span><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span>            </span><span class="hs-identifier">Data.Typeable</span><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span>            </span><span class="hs-identifier">Database.HDBC</span><span>
</span><a name="line-22"></a><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span>  </span><span class="hs-identifier">Data.Time</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Time</span><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span>            </span><a href="Database.Orville.Internal.Expr.html"><span class="hs-identifier">Database.Orville.Internal.Expr</span></a><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span>            </span><a href="Database.Orville.Internal.QueryKey.html"><span class="hs-identifier">Database.Orville.Internal.QueryKey</span></a><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span class="hs-keyword">type</span><span> </span><a name="Record"><a href="Database.Orville.Internal.Types.html#Record"><span class="hs-identifier">Record</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-29"></a><span class="hs-keyword">type</span><span> </span><a name="CreatedAt"><a href="Database.Orville.Internal.Types.html#CreatedAt"><span class="hs-identifier">CreatedAt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Time.UTCTime</span><span>
</span><a name="line-30"></a><span class="hs-keyword">type</span><span> </span><a name="UpdatedAt"><a href="Database.Orville.Internal.Types.html#UpdatedAt"><span class="hs-identifier">UpdatedAt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Time.UTCTime</span><span>
</span><a name="line-31"></a><span class="hs-keyword">type</span><span> </span><a name="OccurredAt"><a href="Database.Orville.Internal.Types.html#OccurredAt"><span class="hs-identifier">OccurredAt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Time.UTCTime</span><span>
</span><a name="line-32"></a><span>
</span><a name="line-33"></a><span class="hs-keyword">data</span><span> </span><a name="ColumnType"><a href="Database.Orville.Internal.Types.html#ColumnType"><span class="hs-identifier">ColumnType</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-34"></a><span>    </span><a name="AutomaticId"><a href="Database.Orville.Internal.Types.html#AutomaticId"><span class="hs-identifier">AutomaticId</span></a></a><span>
</span><a name="line-35"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ForeignId"><a href="Database.Orville.Internal.Types.html#ForeignId"><span class="hs-identifier">ForeignId</span></a></a><span>
</span><a name="line-36"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Text"><a href="Database.Orville.Internal.Types.html#Text"><span class="hs-identifier">Text</span></a></a><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-37"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="VarText"><a href="Database.Orville.Internal.Types.html#VarText"><span class="hs-identifier">VarText</span></a></a><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-38"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Date"><a href="Database.Orville.Internal.Types.html#Date"><span class="hs-identifier">Date</span></a></a><span>
</span><a name="line-39"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Timestamp"><a href="Database.Orville.Internal.Types.html#Timestamp"><span class="hs-identifier">Timestamp</span></a></a><span>
</span><a name="line-40"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Integer"><a href="Database.Orville.Internal.Types.html#Integer"><span class="hs-identifier">Integer</span></a></a><span>
</span><a name="line-41"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="BigInteger"><a href="Database.Orville.Internal.Types.html#BigInteger"><span class="hs-identifier">BigInteger</span></a></a><span>
</span><a name="line-42"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="TextSearchVector"><a href="Database.Orville.Internal.Types.html#TextSearchVector"><span class="hs-identifier">TextSearchVector</span></a></a><span>
</span><a name="line-43"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Double"><a href="Database.Orville.Internal.Types.html#Double"><span class="hs-identifier">Double</span></a></a><span>
</span><a name="line-44"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Boolean"><a href="Database.Orville.Internal.Types.html#Boolean"><span class="hs-identifier">Boolean</span></a></a><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span class="hs-keyword">data</span><span> </span><a name="ColumnFlag"><a href="Database.Orville.Internal.Types.html#ColumnFlag"><span class="hs-identifier">ColumnFlag</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-47"></a><span>    </span><a name="PrimaryKey"><a href="Database.Orville.Internal.Types.html#PrimaryKey"><span class="hs-identifier">PrimaryKey</span></a></a><span>
</span><a name="line-48"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679091261"><a href="#local-6989586621679091261"><span class="hs-identifier">a</span></a></a><span class="hs-operator">.</span><span> </span><a href="Database.Orville.Internal.Types.html#ColumnDefault"><span class="hs-identifier hs-type">ColumnDefault</span></a><span> </span><a href="#local-6989586621679091261"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="Default"><a href="Database.Orville.Internal.Types.html#Default"><span class="hs-identifier">Default</span></a></a><span> </span><a href="#local-6989586621679091261"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-49"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Null"><a href="Database.Orville.Internal.Types.html#Null"><span class="hs-identifier">Null</span></a></a><span>
</span><a name="line-50"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Unique"><a href="Database.Orville.Internal.Types.html#Unique"><span class="hs-identifier">Unique</span></a></a><span>
</span><a name="line-51"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679091262"><a href="#local-6989586621679091262"><span class="hs-identifier">entity</span></a></a><span class="hs-operator">.</span><span> </span><a name="References"><a href="Database.Orville.Internal.Types.html#References"><span class="hs-identifier">References</span></a></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.Internal.Types.html#TableDefinition"><span class="hs-identifier hs-type">TableDefinition</span></a><span> </span><a href="#local-6989586621679091262"><span class="hs-identifier hs-type">entity</span></a><span class="hs-special">)</span><span> </span><a href="Database.Orville.Internal.Types.html#FieldDefinition"><span class="hs-identifier hs-type">FieldDefinition</span></a><span>
</span><a name="line-52"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ColumnDescription"><a href="Database.Orville.Internal.Types.html#ColumnDescription"><span class="hs-identifier">ColumnDescription</span></a></a><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span class="hs-keyword">class</span><span> </span><a name="ColumnDefault"><a href="Database.Orville.Internal.Types.html#ColumnDefault"><span class="hs-identifier">ColumnDefault</span></a></a><span> </span><a name="local-6989586621679091260"><a href="#local-6989586621679091260"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-55"></a><span>  </span><a name="toColumnDefaultSql"><a href="Database.Orville.Internal.Types.html#toColumnDefaultSql"><span class="hs-identifier">toColumnDefaultSql</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679091260"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span class="hs-keyword">data</span><span> </span><a name="Now"><a href="Database.Orville.Internal.Types.html#Now"><span class="hs-identifier">Now</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Now"><a href="Database.Orville.Internal.Types.html#Now"><span class="hs-identifier">Now</span></a></a><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span class="hs-keyword">instance</span><span> </span><a href="Database.Orville.Internal.Types.html#ColumnDefault"><span class="hs-identifier hs-type">ColumnDefault</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Char</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-60"></a><span>  </span><a name="local-8214565720323865971"><a href="Database.Orville.Internal.Types.html#toColumnDefaultSql"><span class="hs-identifier">toColumnDefaultSql</span></a></a><span> </span><a name="local-6989586621679091280"><a href="#local-6989586621679091280"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;'&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679091280"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;'&quot;</span><span>
</span><a name="line-61"></a><span>
</span><a name="line-62"></a><span class="hs-keyword">instance</span><span> </span><a href="Database.Orville.Internal.Types.html#ColumnDefault"><span class="hs-identifier hs-type">ColumnDefault</span></a><span> </span><a href="Database.Orville.Internal.Types.html#Now"><span class="hs-identifier hs-type">Now</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-63"></a><span>  </span><a name="local-8214565720323865971"><a href="Database.Orville.Internal.Types.html#toColumnDefaultSql"><span class="hs-identifier">toColumnDefaultSql</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;(now() at time zone 'utc')&quot;</span><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-keyword">instance</span><span> </span><a href="Database.Orville.Internal.Types.html#ColumnDefault"><span class="hs-identifier hs-type">ColumnDefault</span></a><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-66"></a><span>  </span><a name="local-8214565720323865971"><a href="Database.Orville.Internal.Types.html#toColumnDefaultSql"><span class="hs-identifier">toColumnDefaultSql</span></a></a><span> </span><a name="local-6989586621679091279"><a href="#local-6989586621679091279"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679091279"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-keyword">instance</span><span> </span><a href="Database.Orville.Internal.Types.html#ColumnDefault"><span class="hs-identifier hs-type">ColumnDefault</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-69"></a><span>  </span><a name="local-8214565720323865971"><a href="Database.Orville.Internal.Types.html#toColumnDefaultSql"><span class="hs-identifier">toColumnDefaultSql</span></a></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;true&quot;</span><span>
</span><a name="line-70"></a><span>  </span><span class="hs-identifier">toColumnDefaultSql</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;false&quot;</span><span>
</span><a name="line-71"></a><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span class="hs-keyword">type</span><span> </span><a name="FieldDefinition"><a href="Database.Orville.Internal.Types.html#FieldDefinition"><span class="hs-identifier">FieldDefinition</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><a href="Database.Orville.Internal.Types.html#ColumnType"><span class="hs-identifier hs-type">ColumnType</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Database.Orville.Internal.Types.html#ColumnFlag"><span class="hs-identifier hs-type">ColumnFlag</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-74"></a><span>
</span><a name="line-75"></a><span class="hs-keyword">instance</span><span> </span><a href="Database.Orville.Internal.QueryKey.html#QueryKeyable"><span class="hs-identifier hs-type">QueryKeyable</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><a href="Database.Orville.Internal.Types.html#ColumnType"><span class="hs-identifier hs-type">ColumnType</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Database.Orville.Internal.Types.html#ColumnFlag"><span class="hs-identifier hs-type">ColumnFlag</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-76"></a><span>  </span><a name="local-8214565720323861259"><a href="Database.Orville.Internal.QueryKey.html#queryKey"><span class="hs-identifier">queryKey</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679091278"><a href="#local-6989586621679091278"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Database.Orville.Internal.QueryKey.html#QKField"><span class="hs-identifier hs-var">QKField</span></a><span> </span><a href="#local-6989586621679091278"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-77"></a><span>
</span><a name="line-78"></a><span class="hs-keyword">data</span><span> </span><a name="FieldUpdate"><a href="Database.Orville.Internal.Types.html#FieldUpdate"><span class="hs-identifier">FieldUpdate</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="FieldUpdate"><a href="Database.Orville.Internal.Types.html#FieldUpdate"><span class="hs-identifier">FieldUpdate</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-79"></a><span>    </span><a name="fieldUpdateField"><a href="Database.Orville.Internal.Types.html#fieldUpdateField"><span class="hs-identifier">fieldUpdateField</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.Internal.Types.html#FieldDefinition"><span class="hs-identifier hs-type">FieldDefinition</span></a><span>
</span><a name="line-80"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="fieldUpdateValue"><a href="Database.Orville.Internal.Types.html#fieldUpdateValue"><span class="hs-identifier">fieldUpdateValue</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SqlValue</span><span>
</span><a name="line-81"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span class="hs-keyword">data</span><span> </span><a name="TableComment"><a href="Database.Orville.Internal.Types.html#TableComment"><span class="hs-identifier">TableComment</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="TableComment"><a href="Database.Orville.Internal.Types.html#TableComment"><span class="hs-identifier">TableComment</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-84"></a><span>    </span><a name="tcWhat"><a href="Database.Orville.Internal.Types.html#tcWhat"><span class="hs-identifier">tcWhat</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-85"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="tcWhen"><a href="Database.Orville.Internal.Types.html#tcWhen"><span class="hs-identifier">tcWhen</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-86"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="tcWho"><a href="Database.Orville.Internal.Types.html#tcWho"><span class="hs-identifier">tcWho</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-87"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-88"></a><span>
</span><a name="line-89"></a><span class="hs-keyword">newtype</span><span> </span><a name="TableComments"><a href="Database.Orville.Internal.Types.html#TableComments"><span class="hs-identifier">TableComments</span></a></a><span> </span><a name="local-6989586621679091259"><a href="#local-6989586621679091259"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="TableComments"><a href="Database.Orville.Internal.Types.html#TableComments"><span class="hs-identifier">TableComments</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Writer</span><span> </span><span class="hs-special">[</span><a href="Database.Orville.Internal.Types.html#TableComment"><span class="hs-identifier hs-type">TableComment</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679091259"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-90"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Functor</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span class="hs-special">)</span><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span class="hs-identifier">runComments</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.Internal.Types.html#TableComments"><span class="hs-identifier hs-type">TableComments</span></a><span> </span><a href="#local-6989586621679091286"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Database.Orville.Internal.Types.html#TableComment"><span class="hs-identifier hs-type">TableComment</span></a><span class="hs-special">]</span><span>
</span><a name="line-93"></a><a name="runComments"><a href="Database.Orville.Internal.Types.html#runComments"><span class="hs-identifier">runComments</span></a></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.Internal.Types.html#TableComments"><span class="hs-identifier hs-var">TableComments</span></a><span> </span><a name="local-6989586621679091287"><a href="#local-6989586621679091287"><span class="hs-identifier">commenter</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">runWriter</span><span> </span><a href="#local-6989586621679091287"><span class="hs-identifier hs-var">commenter</span></a><span class="hs-special">)</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-identifier">noComments</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.Internal.Types.html#TableComments"><span class="hs-identifier hs-type">TableComments</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-96"></a><a name="noComments"><a href="Database.Orville.Internal.Types.html#noComments"><span class="hs-identifier">noComments</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-97"></a><span>
</span><a name="line-98"></a><span class="hs-identifier">say</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.Internal.Types.html#TableComments"><span class="hs-identifier hs-type">TableComments</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-99"></a><a name="say"><a href="Database.Orville.Internal.Types.html#say"><span class="hs-identifier">say</span></a></a><span> </span><a name="local-6989586621679091303"><a href="#local-6989586621679091303"><span class="hs-identifier">msg</span></a></a><span> </span><a name="local-6989586621679091304"><a href="#local-6989586621679091304"><span class="hs-identifier">date</span></a></a><span> </span><a name="local-6989586621679091305"><a href="#local-6989586621679091305"><span class="hs-identifier">commenter</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Database.Orville.Internal.Types.html#TableComments"><span class="hs-identifier hs-var">TableComments</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-100"></a><span>  </span><span class="hs-identifier hs-var">writer</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Database.Orville.Internal.Types.html#TableComment"><span class="hs-identifier hs-var">TableComment</span></a><span> </span><a href="#local-6989586621679091303"><span class="hs-identifier hs-var">msg</span></a><span> </span><a href="#local-6989586621679091304"><span class="hs-identifier hs-var">date</span></a><span> </span><a href="#local-6989586621679091305"><span class="hs-identifier hs-var">commenter</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span class="hs-keyword">data</span><span> </span><a name="FromSqlError"><a href="Database.Orville.Internal.Types.html#FromSqlError"><span class="hs-identifier">FromSqlError</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-103"></a><span>    </span><a name="RowDataError"><a href="Database.Orville.Internal.Types.html#RowDataError"><span class="hs-identifier">RowDataError</span></a></a><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-104"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="QueryError"><a href="Database.Orville.Internal.Types.html#QueryError"><span class="hs-identifier">QueryError</span></a></a><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-105"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span class="hs-special">)</span><span>
</span><a name="line-106"></a><span>
</span><a name="line-107"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Exception</span><span> </span><a href="Database.Orville.Internal.Types.html#FromSqlError"><span class="hs-identifier hs-type">FromSqlError</span></a><span>
</span><a name="line-108"></a><span>
</span><a name="line-109"></a><span class="hs-keyword">data</span><span> </span><a name="FromSql"><a href="Database.Orville.Internal.Types.html#FromSql"><span class="hs-identifier">FromSql</span></a></a><span> </span><a name="local-6989586621679091258"><a href="#local-6989586621679091258"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="FromSql"><a href="Database.Orville.Internal.Types.html#FromSql"><span class="hs-identifier">FromSql</span></a></a><span>
</span><a name="line-110"></a><span>  </span><span class="hs-special">{</span><span> </span><a name="fromSqlSelects"><a href="Database.Orville.Internal.Types.html#fromSqlSelects"><span class="hs-identifier">fromSqlSelects</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Database.Orville.Internal.Expr.SelectExpr.html#SelectForm"><span class="hs-identifier hs-type">SelectForm</span></a><span class="hs-special">]</span><span>
</span><a name="line-111"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="runFromSql"><a href="Database.Orville.Internal.Types.html#runFromSql"><span class="hs-identifier">runFromSql</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">SqlValue</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Database.Orville.Internal.Types.html#FromSqlError"><span class="hs-identifier hs-type">FromSqlError</span></a><span> </span><a href="#local-6989586621679091258"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-112"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="Database.Orville.Internal.Types.html#FromSql"><span class="hs-identifier hs-type">FromSql</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-115"></a><span>  </span><a name="local-3458764513820541101"><span class="hs-identifier">fmap</span></a><span> </span><a name="local-6989586621679091275"><a href="#local-6989586621679091275"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679091276"><a href="#local-6989586621679091276"><span class="hs-identifier">fA</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679091276"><span class="hs-identifier hs-var">fA</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">runFromSql</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679091277"><a href="#local-6989586621679091277"><span class="hs-identifier">values</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679091275"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier">runFromSql</span><span> </span><a href="#local-6989586621679091276"><span class="hs-identifier hs-var">fA</span></a><span> </span><a href="#local-6989586621679091277"><span class="hs-identifier hs-var">values</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-116"></a><span>
</span><a name="line-117"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="Database.Orville.Internal.Types.html#FromSql"><span class="hs-identifier hs-type">FromSql</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-118"></a><span>  </span><a name="local-3458764513820541680"><span class="hs-identifier">pure</span></a><span> </span><a name="local-6989586621679091271"><a href="#local-6989586621679091271"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Database.Orville.Internal.Types.html#FromSql"><span class="hs-identifier hs-var">FromSql</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679091271"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-119"></a><span>  </span><a name="local-6989586621679091272"><a href="#local-6989586621679091272"><span class="hs-identifier">fF</span></a></a><span> </span><a name="local-3458764513820541679"><span class="hs-operator">&lt;*&gt;</span></a><span> </span><a name="local-6989586621679091273"><a href="#local-6989586621679091273"><span class="hs-identifier">fA</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Database.Orville.Internal.Types.html#FromSql"><span class="hs-identifier hs-var">FromSql</span></a><span>
</span><a name="line-120"></a><span>    </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fromSqlSelects</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fromSqlSelects</span><span> </span><a href="#local-6989586621679091272"><span class="hs-identifier hs-var">fF</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier">fromSqlSelects</span><span> </span><a href="#local-6989586621679091273"><span class="hs-identifier hs-var">fA</span></a><span>
</span><a name="line-121"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">runFromSql</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679091274"><a href="#local-6989586621679091274"><span class="hs-identifier">values</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">runFromSql</span><span> </span><a href="#local-6989586621679091272"><span class="hs-identifier hs-var">fF</span></a><span> </span><a href="#local-6989586621679091274"><span class="hs-identifier hs-var">values</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier">runFromSql</span><span> </span><a href="#local-6989586621679091273"><span class="hs-identifier hs-var">fA</span></a><span> </span><a href="#local-6989586621679091274"><span class="hs-identifier hs-var">values</span></a><span>
</span><a name="line-122"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span class="hs-identifier">getColumn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.Internal.Expr.SelectExpr.html#SelectForm"><span class="hs-identifier hs-type">SelectForm</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.Internal.Types.html#FromSql"><span class="hs-identifier hs-type">FromSql</span></a><span> </span><span class="hs-identifier hs-type">SqlValue</span><span>
</span><a name="line-125"></a><a name="getColumn"><a href="Database.Orville.Internal.Types.html#getColumn"><span class="hs-identifier">getColumn</span></a></a><span> </span><a name="local-6989586621679091459"><a href="#local-6989586621679091459"><span class="hs-identifier">selectForm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Database.Orville.Internal.Types.html#FromSql"><span class="hs-identifier hs-var">FromSql</span></a><span>
</span><a name="line-126"></a><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fromSqlSelects</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679091459"><span class="hs-identifier hs-var">selectForm</span></a><span class="hs-special">]</span><span>
</span><a name="line-127"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">runFromSql</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679091460"><a href="#local-6989586621679091460"><span class="hs-identifier">values</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-128"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679091461"><a href="#local-6989586621679091461"><span class="hs-identifier">output</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Database.Orville.Internal.Expr.NameExpr.html#unescapedName"><span class="hs-identifier hs-var">unescapedName</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Database.Orville.Internal.Expr.SelectExpr.html#selectFormOutput"><span class="hs-identifier hs-var">selectFormOutput</span></a><span> </span><a href="#local-6989586621679091459"><span class="hs-identifier hs-var">selectForm</span></a><span>
</span><a name="line-129"></a><span>
</span><a name="line-130"></a><span>      </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">lookup</span><span> </span><a href="#local-6989586621679091461"><span class="hs-identifier hs-var">output</span></a><span> </span><a href="#local-6989586621679091460"><span class="hs-identifier hs-var">values</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-131"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679091645"><a href="#local-6989586621679091645"><span class="hs-identifier">sqlValue</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679091645"><span class="hs-identifier hs-var">sqlValue</span></a><span>
</span><a name="line-132"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-133"></a><span>          </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Database.Orville.Internal.Types.html#QueryError"><span class="hs-identifier hs-var">QueryError</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-string">&quot;Column &quot;</span><span>
</span><a name="line-134"></a><span>                                           </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679091461"><span class="hs-identifier hs-var">output</span></a><span>
</span><a name="line-135"></a><span>                                           </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot; not found in result set, &quot;</span><span>
</span><a name="line-136"></a><span>                                           </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot; actual columns: &quot;</span><span>
</span><a name="line-137"></a><span>                                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">List.intercalate</span><span> </span><span class="hs-string">&quot;,&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679091460"><span class="hs-identifier hs-var">values</span></a><span>
</span><a name="line-138"></a><span>                                           </span><span class="hs-special">]</span><span>
</span><a name="line-139"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-140"></a><span>
</span><a name="line-141"></a><span class="hs-identifier">joinFromSqlError</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.Internal.Types.html#FromSql"><span class="hs-identifier hs-type">FromSql</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Database.Orville.Internal.Types.html#FromSqlError"><span class="hs-identifier hs-type">FromSqlError</span></a><span> </span><a href="#local-6989586621679091285"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.Internal.Types.html#FromSql"><span class="hs-identifier hs-type">FromSql</span></a><span> </span><a href="#local-6989586621679091285"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-142"></a><a name="joinFromSqlError"><a href="Database.Orville.Internal.Types.html#joinFromSqlError"><span class="hs-identifier">joinFromSqlError</span></a></a><span> </span><a name="local-6989586621679091646"><a href="#local-6989586621679091646"><span class="hs-identifier">fE</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679091646"><span class="hs-identifier hs-var">fE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">runFromSql</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679091647"><a href="#local-6989586621679091647"><span class="hs-identifier">columns</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">join</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">runFromSql</span><span> </span><a href="#local-6989586621679091646"><span class="hs-identifier hs-var">fE</span></a><span> </span><a href="#local-6989586621679091647"><span class="hs-identifier hs-var">columns</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-143"></a><span>
</span><a name="line-144"></a><span>
</span><a name="line-145"></a><span class="hs-keyword">newtype</span><span> </span><a name="ToSql"><a href="Database.Orville.Internal.Types.html#ToSql"><span class="hs-identifier">ToSql</span></a></a><span> </span><a name="local-6989586621679091097"><a href="#local-6989586621679091097"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679091098"><a href="#local-6989586621679091098"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ToSql"><a href="Database.Orville.Internal.Types.html#ToSql"><span class="hs-identifier">ToSql</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="unToSql"><a href="Database.Orville.Internal.Types.html#unToSql"><span class="hs-identifier">unToSql</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ReaderT</span><span> </span><a href="#local-6989586621679091097"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-146"></a><span>                                       </span><span class="hs-special">(</span><span class="hs-identifier hs-type">State</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">SqlValue</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-147"></a><span>                                       </span><a href="#local-6989586621679091098"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-148"></a><span>                          </span><span class="hs-special">}</span><span>
</span><a name="line-149"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Functor</span><span>
</span><a name="line-150"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span>
</span><a name="line-151"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span>
</span><a name="line-152"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadState</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">SqlValue</span><span class="hs-special">]</span><span>
</span><a name="line-153"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadReader</span><span> </span><a href="#local-6989586621679091097"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-154"></a><span>           </span><span class="hs-special">)</span><span>
</span><a name="line-155"></a><span>
</span><a name="line-156"></a><span class="hs-identifier">runToSql</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.Internal.Types.html#ToSql"><span class="hs-identifier hs-type">ToSql</span></a><span> </span><a href="#local-6989586621679091283"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679091284"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679091283"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">SqlValue</span><span class="hs-special">]</span><span>
</span><a name="line-157"></a><a name="runToSql"><a href="Database.Orville.Internal.Types.html#runToSql"><span class="hs-identifier">runToSql</span></a></a><span> </span><a name="local-6989586621679091648"><a href="#local-6989586621679091648"><span class="hs-identifier">tosql</span></a></a><span> </span><a name="local-6989586621679091649"><a href="#local-6989586621679091649"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">reverse</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">execState</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">runReaderT</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unToSql</span><span> </span><a href="#local-6989586621679091648"><span class="hs-identifier hs-var">tosql</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679091649"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-158"></a><span>
</span><a name="line-159"></a><span class="hs-identifier">getComponent</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679091281"><span class="hs-identifier hs-type">entity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679091282"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.Internal.Types.html#ToSql"><span class="hs-identifier hs-type">ToSql</span></a><span> </span><a href="#local-6989586621679091282"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Orville.Internal.Types.html#ToSql"><span class="hs-identifier hs-type">ToSql</span></a><span> </span><a href="#local-6989586621679091281"><span class="hs-identifier hs-type">entity</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-160"></a><a name="getComponent"><a href="Database.Orville.Internal.Types.html#getComponent"><span class="hs-identifier">getComponent</span></a></a><span> </span><a name="local-6989586621679091650"><a href="#local-6989586621679091650"><span class="hs-identifier">getComp</span></a></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.Internal.Types.html#ToSql"><span class="hs-identifier hs-var">ToSql</span></a><span> </span><a name="local-6989586621679091651"><a href="#local-6989586621679091651"><span class="hs-identifier">serializer</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-161"></a><span>  </span><a href="Database.Orville.Internal.Types.html#ToSql"><span class="hs-identifier hs-var">ToSql</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">withReaderT</span><span> </span><a href="#local-6989586621679091650"><span class="hs-identifier hs-var">getComp</span></a><span> </span><a href="#local-6989586621679091651"><span class="hs-identifier hs-var">serializer</span></a><span class="hs-special">)</span><span>
</span><a name="line-162"></a><span>
</span><a name="line-163"></a><span class="hs-comment">{-|
 A 'TableDefinition' is the center of the Orville universe. A 'TableDefinition'
 defines the structure of a table in the database and associates it with a Haskell
 datatype, usually a Haskell record type. The 'TableDefinition' must specify how
 the Haskell type is converted to and from the database schema, as as well as
 provide same basic utility functions required by Orville for interacting with
 the Haskell datatype.

  Usually you will use 'TableParams' to construct a 'TableDefinition' in a more
  concise way. This type is provided as an escape hatch for any situations where
  'TableParams' is too restrictive for the sql mapping required by a type.
 -}</span><span>
</span><a name="line-175"></a><span class="hs-keyword">data</span><span> </span><a name="TableDefinition"><a href="Database.Orville.Internal.Types.html#TableDefinition"><span class="hs-identifier">TableDefinition</span></a></a><span> </span><a name="local-6989586621679091092"><a href="#local-6989586621679091092"><span class="hs-identifier">entity</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-176"></a><span>  </span><a name="TableDefinition"><a href="Database.Orville.Internal.Types.html#TableDefinition"><span class="hs-identifier">TableDefinition</span></a></a><span>
</span><a name="line-177"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="tableName"><a href="Database.Orville.Internal.Types.html#tableName"><span class="hs-identifier">tableName</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-178"></a><span>      </span><span class="hs-comment">-- ^ The name of the table in the database.</span><span>
</span><a name="line-179"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="tableFields"><a href="Database.Orville.Internal.Types.html#tableFields"><span class="hs-identifier">tableFields</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Database.Orville.Internal.Types.html#FieldDefinition"><span class="hs-identifier hs-type">FieldDefinition</span></a><span class="hs-special">]</span><span>
</span><a name="line-180"></a><span>      </span><span class="hs-comment">-- ^ A list of field definitions defining the table structure</span><span>
</span><a name="line-181"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="tableSafeToDelete"><a href="Database.Orville.Internal.Types.html#tableSafeToDelete"><span class="hs-identifier">tableSafeToDelete</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-182"></a><span>      </span><span class="hs-comment">-- ^ A list of any columns that may be deleted from the table by Orville.</span><span>
</span><a name="line-183"></a><span>      </span><span class="hs-comment">-- (Orville will never delete a column without being told it is safe)</span><span>
</span><a name="line-184"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="tableFromSql"><a href="Database.Orville.Internal.Types.html#tableFromSql"><span class="hs-identifier">tableFromSql</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.Internal.Types.html#FromSql"><span class="hs-identifier hs-type">FromSql</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679091092"><span class="hs-identifier hs-type">entity</span></a><span> </span><a href="Database.Orville.Internal.Types.html#Record"><span class="hs-identifier hs-type">Record</span></a><span class="hs-special">)</span><span>
</span><a name="line-185"></a><span>      </span><span class="hs-comment">-- ^ A definition of how to convert the haskell type from a sql row</span><span>
</span><a name="line-186"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="tableToSql"><a href="Database.Orville.Internal.Types.html#tableToSql"><span class="hs-identifier">tableToSql</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679091093"><a href="#local-6989586621679091093"><span class="hs-identifier">key</span></a></a><span class="hs-operator">.</span><span> </span><a href="Database.Orville.Internal.Types.html#ToSql"><span class="hs-identifier hs-type">ToSql</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679091092"><span class="hs-identifier hs-type">entity</span></a><span> </span><a href="#local-6989586621679091093"><span class="hs-identifier hs-type">key</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-187"></a><span>      </span><span class="hs-comment">-- ^ A definition of how to convert the haskell type to a sql row</span><span>
</span><a name="line-188"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="tableSetKey"><a href="Database.Orville.Internal.Types.html#tableSetKey"><span class="hs-identifier">tableSetKey</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679091094"><a href="#local-6989586621679091094"><span class="hs-identifier">key1</span></a></a><span> </span><a name="local-6989586621679091095"><a href="#local-6989586621679091095"><span class="hs-identifier">key2</span></a></a><span class="hs-operator">.</span><span> </span><a href="#local-6989586621679091095"><span class="hs-identifier hs-type">key2</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679091092"><span class="hs-identifier hs-type">entity</span></a><span> </span><a href="#local-6989586621679091094"><span class="hs-identifier hs-type">key1</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679091092"><span class="hs-identifier hs-type">entity</span></a><span> </span><a href="#local-6989586621679091095"><span class="hs-identifier hs-type">key2</span></a><span>
</span><a name="line-189"></a><span>      </span><span class="hs-comment">-- ^ A function to set the key on the entity</span><span>
</span><a name="line-190"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="tableGetKey"><a href="Database.Orville.Internal.Types.html#tableGetKey"><span class="hs-identifier">tableGetKey</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679091096"><a href="#local-6989586621679091096"><span class="hs-identifier">key</span></a></a><span class="hs-operator">.</span><span> </span><a href="#local-6989586621679091092"><span class="hs-identifier hs-type">entity</span></a><span> </span><a href="#local-6989586621679091096"><span class="hs-identifier hs-type">key</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679091096"><span class="hs-identifier hs-type">key</span></a><span>
</span><a name="line-191"></a><span>      </span><span class="hs-comment">-- ^ A function to get the key on the entity</span><span>
</span><a name="line-192"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="tableComments"><a href="Database.Orville.Internal.Types.html#tableComments"><span class="hs-identifier">tableComments</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Orville.Internal.Types.html#TableComments"><span class="hs-identifier hs-type">TableComments</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-193"></a><span>      </span><span class="hs-comment">-- ^ Any comments that might be interesting for developers to see. These</span><span>
</span><a name="line-194"></a><span>      </span><span class="hs-comment">-- comments will get printed in the log if there is an erro while attempting</span><span>
</span><a name="line-195"></a><span>      </span><span class="hs-comment">-- to migrate the table.</span><span>
</span><a name="line-196"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-197"></a><span>
</span><a name="line-198"></a><span class="hs-keyword">instance</span><span> </span><a href="Database.Orville.Internal.QueryKey.html#QueryKeyable"><span class="hs-identifier hs-type">QueryKeyable</span></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.Internal.Types.html#TableDefinition"><span class="hs-identifier hs-type">TableDefinition</span></a><span> </span><a href="#local-6989586621679091270"><span class="hs-identifier hs-type">entity</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-199"></a><span>  </span><a name="local-8214565720323861259"><a href="Database.Orville.Internal.QueryKey.html#queryKey"><span class="hs-identifier">queryKey</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Database.Orville.Internal.QueryKey.html#QKTable"><span class="hs-identifier hs-var">QKTable</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">tableName</span><span>
</span><a name="line-200"></a><span>
</span><a name="line-201"></a><span class="hs-keyword">data</span><span> </span><a name="SchemaItem"><a href="Database.Orville.Internal.Types.html#SchemaItem"><span class="hs-identifier">SchemaItem</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-202"></a><span>    </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679091091"><a href="#local-6989586621679091091"><span class="hs-identifier">entity</span></a></a><span class="hs-operator">.</span><span> </span><a name="Table"><a href="Database.Orville.Internal.Types.html#Table"><span class="hs-identifier">Table</span></a></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.Internal.Types.html#TableDefinition"><span class="hs-identifier hs-type">TableDefinition</span></a><span> </span><a href="#local-6989586621679091091"><span class="hs-identifier hs-type">entity</span></a><span class="hs-special">)</span><span>
</span><a name="line-203"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="DropTable"><a href="Database.Orville.Internal.Types.html#DropTable"><span class="hs-identifier">DropTable</span></a></a><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-204"></a><span>
</span><a name="line-205"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Index"><a href="Database.Orville.Internal.Types.html#Index"><span class="hs-identifier">Index</span></a></a><span> </span><a href="Database.Orville.Internal.Types.html#IndexDefinition"><span class="hs-identifier hs-type">IndexDefinition</span></a><span>
</span><a name="line-206"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="DropIndex"><a href="Database.Orville.Internal.Types.html#DropIndex"><span class="hs-identifier">DropIndex</span></a></a><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-207"></a><span>
</span><a name="line-208"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Constraint"><a href="Database.Orville.Internal.Types.html#Constraint"><span class="hs-identifier">Constraint</span></a></a><span> </span><a href="Database.Orville.Internal.Types.html#ConstraintDefinition"><span class="hs-identifier hs-type">ConstraintDefinition</span></a><span>
</span><a name="line-209"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="DropConstraint"><a href="Database.Orville.Internal.Types.html#DropConstraint"><span class="hs-identifier">DropConstraint</span></a></a><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-210"></a><span>
</span><a name="line-211"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="Database.Orville.Internal.Types.html#SchemaItem"><span class="hs-identifier hs-type">SchemaItem</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-212"></a><span>  </span><a name="local-8214565720323790842"><span class="hs-identifier">show</span></a><span> </span><span class="hs-special">(</span><a href="Database.Orville.Internal.Types.html#Table"><span class="hs-identifier hs-var">Table</span></a><span> </span><a name="local-6989586621679091263"><a href="#local-6989586621679091263"><span class="hs-identifier">tableDef</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Table &lt;&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier">tableName</span><span> </span><a href="#local-6989586621679091263"><span class="hs-identifier hs-var">tableDef</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; definition&gt;&quot;</span><span>
</span><a name="line-213"></a><span>  </span><span class="hs-identifier">show</span><span> </span><span class="hs-special">(</span><a href="Database.Orville.Internal.Types.html#DropTable"><span class="hs-identifier hs-var">DropTable</span></a><span> </span><a name="local-6989586621679091264"><a href="#local-6989586621679091264"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;DropTable &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679091264"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-214"></a><span>  </span><span class="hs-identifier">show</span><span> </span><span class="hs-special">(</span><a href="Database.Orville.Internal.Types.html#Index"><span class="hs-identifier hs-var">Index</span></a><span> </span><a name="local-6989586621679091265"><a href="#local-6989586621679091265"><span class="hs-identifier">indexDef</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Index (&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679091265"><span class="hs-identifier hs-var">indexDef</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;)&quot;</span><span>
</span><a name="line-215"></a><span>  </span><span class="hs-identifier">show</span><span> </span><span class="hs-special">(</span><a href="Database.Orville.Internal.Types.html#DropIndex"><span class="hs-identifier hs-var">DropIndex</span></a><span> </span><a name="local-6989586621679091266"><a href="#local-6989586621679091266"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;DropIndex &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679091266"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-216"></a><span>  </span><span class="hs-identifier">show</span><span> </span><span class="hs-special">(</span><a href="Database.Orville.Internal.Types.html#Constraint"><span class="hs-identifier hs-var">Constraint</span></a><span> </span><a name="local-6989586621679091267"><a href="#local-6989586621679091267"><span class="hs-identifier">cons</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Constraint (&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679091267"><span class="hs-identifier hs-var">cons</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;)&quot;</span><span>
</span><a name="line-217"></a><span>  </span><span class="hs-identifier">show</span><span> </span><span class="hs-special">(</span><a href="Database.Orville.Internal.Types.html#DropConstraint"><span class="hs-identifier hs-var">DropConstraint</span></a><span> </span><a name="local-6989586621679091268"><a href="#local-6989586621679091268"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679091269"><a href="#local-6989586621679091269"><span class="hs-identifier">table</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;DropConstraint &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679091268"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679091269"><span class="hs-identifier hs-var">table</span></a><span>
</span><a name="line-218"></a><span>
</span><a name="line-219"></a><span class="hs-keyword">type</span><span> </span><a name="SchemaDefinition"><a href="Database.Orville.Internal.Types.html#SchemaDefinition"><span class="hs-identifier">SchemaDefinition</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Database.Orville.Internal.Types.html#SchemaItem"><span class="hs-identifier hs-type">SchemaItem</span></a><span class="hs-special">]</span><span>
</span><a name="line-220"></a><span>
</span><a name="line-221"></a><span class="hs-keyword">data</span><span> </span><a name="IndexDefinition"><a href="Database.Orville.Internal.Types.html#IndexDefinition"><span class="hs-identifier">IndexDefinition</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="IndexDefinition"><a href="Database.Orville.Internal.Types.html#IndexDefinition"><span class="hs-identifier">IndexDefinition</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-222"></a><span>    </span><a name="indexName"><a href="Database.Orville.Internal.Types.html#indexName"><span class="hs-identifier">indexName</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-223"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="indexUnique"><a href="Database.Orville.Internal.Types.html#indexUnique"><span class="hs-identifier">indexUnique</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-224"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="indexTable"><a href="Database.Orville.Internal.Types.html#indexTable"><span class="hs-identifier">indexTable</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-225"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="indexBody"><a href="Database.Orville.Internal.Types.html#indexBody"><span class="hs-identifier">indexBody</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-226"></a><span>  </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-227"></a><span>
</span><a name="line-228"></a><span class="hs-keyword">data</span><span> </span><a name="ConstraintDefinition"><a href="Database.Orville.Internal.Types.html#ConstraintDefinition"><span class="hs-identifier">ConstraintDefinition</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ConstraintDefinition"><a href="Database.Orville.Internal.Types.html#ConstraintDefinition"><span class="hs-identifier">ConstraintDefinition</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-229"></a><span>    </span><a name="constraintName"><a href="Database.Orville.Internal.Types.html#constraintName"><span class="hs-identifier">constraintName</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-230"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="constraintTable"><a href="Database.Orville.Internal.Types.html#constraintTable"><span class="hs-identifier">constraintTable</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-231"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="constraintBody"><a href="Database.Orville.Internal.Types.html#constraintBody"><span class="hs-identifier">constraintBody</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-232"></a><span>  </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-233"></a></pre></body></html>